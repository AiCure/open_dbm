"use strict";(self.webpackChunkopendbm_website=self.webpackChunkopendbm_website||[]).push([[8801],{5318:function(e,t,n){n.d(t,{Zo:function(){return c},kt:function(){return m}});var a=n(7378);function r(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function l(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function o(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?l(Object(n),!0).forEach((function(t){r(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):l(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function i(e,t){if(null==e)return{};var n,a,r=function(e,t){if(null==e)return{};var n,a,r={},l=Object.keys(e);for(a=0;a<l.length;a++)n=l[a],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var l=Object.getOwnPropertySymbols(e);for(a=0;a<l.length;a++)n=l[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}var s=a.createContext({}),u=function(e){var t=a.useContext(s),n=t;return e&&(n="function"==typeof e?e(t):o(o({},t),e)),n},c=function(e){var t=u(e.components);return a.createElement(s.Provider,{value:t},e.children)},p={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},d=a.forwardRef((function(e,t){var n=e.components,r=e.mdxType,l=e.originalType,s=e.parentName,c=i(e,["components","mdxType","originalType","parentName"]),d=u(n),m=r,f=d["".concat(s,".").concat(m)]||d[m]||p[m]||l;return n?a.createElement(f,o(o({ref:t},c),{},{components:n})):a.createElement(f,o({ref:t},c))}));function m(e,t){var n=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var l=n.length,o=new Array(l);o[0]=d;var i={};for(var s in t)hasOwnProperty.call(t,s)&&(i[s]=t[s]);i.originalType=e,i.mdxType="string"==typeof e?e:r,o[1]=i;for(var u=2;u<l;u++)o[u]=n[u];return a.createElement.apply(null,o)}return a.createElement.apply(null,n)}d.displayName="MDXCreateElement"},9245:function(e,t,n){n.r(t),n.d(t,{assets:function(){return y},contentTitle:function(){return h},default:function(){return v},frontMatter:function(){return f},metadata:function(){return b},toc:function(){return k}});var a=n(5318),r=n(7789),l=n(6386),o=Object.defineProperty,i=Object.defineProperties,s=Object.getOwnPropertyDescriptors,u=Object.getOwnPropertySymbols,c=Object.prototype.hasOwnProperty,p=Object.prototype.propertyIsEnumerable,d=(e,t,n)=>t in e?o(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,m=(e,t)=>{for(var n in t||(t={}))c.call(t,n)&&d(e,n,t[n]);if(u)for(var n of u(t))p.call(t,n)&&d(e,n,t[n]);return e};const f={id:"odbm-rest-api",title:"OpenDBM REST API"},h=void 0,b={unversionedId:"odbm-rest-api",id:"odbm-rest-api",title:"OpenDBM REST API",description:"Summary",source:"@site/extras/odbm-rest-api.md",sourceDirName:".",slug:"/odbm-rest-api",permalink:"/open_dbm/extras/odbm-rest-api",draft:!1,editUrl:"https://github.com/AiCure/open_dbm/blob/master/docs/extras/odbm-rest-api.md",tags:[],version:"current",lastUpdatedAt:1664889437,formattedLastUpdatedAt:"10/4/2022",frontMatter:{id:"odbm-rest-api",title:"OpenDBM REST API"},sidebar:"extras",previous:{title:"OpenDBM CI CD Pipeline",permalink:"/open_dbm/extras/ci-cd-pipeline"},next:{title:"OpenDBM Documentation",permalink:"/open_dbm/extras/odbm-doc"}},y={},k=[{value:"Summary",id:"summary",level:2},{value:"How to use",id:"how-to-use",level:2},{value:"Technology Stack",id:"technology-stack",level:2},{value:"API Documentations",id:"api-documentations",level:2}],g={toc:k};function v(e){var t,n=e,{components:o}=n,d=((e,t)=>{var n={};for(var a in e)c.call(e,a)&&t.indexOf(a)<0&&(n[a]=e[a]);if(null!=e&&u)for(var a of u(e))t.indexOf(a)<0&&p.call(e,a)&&(n[a]=e[a]);return n})(n,["components"]);return(0,a.kt)("wrapper",(t=m(m({},g),d),i(t,s({components:o,mdxType:"MDXLayout"}))),(0,a.kt)("h2",m({},{id:"summary"}),"Summary"),(0,a.kt)("p",null,"Inside the OpenDBM repository, there is a folder named rest_api. This folder means to showcase that you can leverage OpenDBM library in API service or Web application, which this folder will showcase the former. "),(0,a.kt)("blockquote",null,(0,a.kt)("p",{parentName:"blockquote"},"The OpenDBM API designed with OpenAPI 2.0 to standardize API definition for programmatic usage, better developer experience and documentation. It will also protected by standard security protocol. ")),(0,a.kt)("figure",null,(0,a.kt)("img",{src:"../docs/assets/odbm_api_summary.png",width:"500",alt:"OpenDBM REST API Summary"}),(0,a.kt)("figcaption",null,"ODBM REST API Summary")),(0,a.kt)("h2",m({},{id:"how-to-use"}),"How to use"),(0,a.kt)("p",null,"To use the Rest API is very straighforward"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"Go to the ",(0,a.kt)("inlineCode",{parentName:"li"},"rest_api")," directory"),(0,a.kt)("li",{parentName:"ul"},"Install the neccessary dependencies")),(0,a.kt)("pre",null,(0,a.kt)("code",m({parentName:"pre"},{className:"language-commandline"}),"pip install -r requirements.txt\ndocker pull opendbmteam/dbm-openface\n")),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"Then you can use Make syntax to run it")),(0,a.kt)("pre",null,(0,a.kt)("code",m({parentName:"pre"},{className:"language-commandline"}),"make dev\n")),(0,a.kt)("p",null,"Wait until the rest api ready to serve requests"),(0,a.kt)("pre",null,(0,a.kt)("code",m({parentName:"pre"},{className:"language-bash"}),"INFO:     Will watch for changes in these directories: ['/Users/smarty_not_dummy__user/open_dbm/rest_api/app']\nINFO:     Uvicorn running on http://127.0.0.1:8000 (Press CTRL+C to quit)\nINFO:     Started reloader process [80258] using StatReload\nINFO:     Started server process [80275]\n")),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"You can test using the OpenAPI specs like mentioned in ",(0,a.kt)("a",m({parentName:"li"},{href:"ci-cd-pipeline#unit-tests"}),"here"),". You can open ",(0,a.kt)("inlineCode",{parentName:"li"},"http://127.0.0.1:8000/docs")," or ",(0,a.kt)("inlineCode",{parentName:"li"},"http://127.0.0.1:8000/redoc"),". "),(0,a.kt)("li",{parentName:"ul"},"Before you start using the APIs, you need to create your credentials for authentication. Alternatively, you can try to use username 'aicure' and the password is 'opendbm'. ")),(0,a.kt)("blockquote",null,(0,a.kt)("p",{parentName:"blockquote"},"You can skip below steps if you want to use 'aicure' credential")),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"To create your own username, first you generate your own password by following these steps:")),(0,a.kt)("pre",null,(0,a.kt)("code",m({parentName:"pre"},{className:"language-bash"}),'cd rest_api/app\npython\nPython 3.7.13 (default, Mar 28 2022, 07:24:34) \n[Clang 12.0.0 ] :: Anaconda, Inc. on darwin\nType "help", "copyright", "credits" or "license" for more information.\n')),(0,a.kt)("p",null,"Then you can start type your own password using this python command"),(0,a.kt)("pre",null,(0,a.kt)("code",m({parentName:"pre"},{className:"language-python"}),"from services.auth.auth import get_password_hash\nprint(get_password_hash('test'))\n$2b$12$qYnAxjQd..feDyPBYa/mDuRrH.PkcpNHJk3F.l/c0h3l/1NcZup7O     \n")),(0,a.kt)("p",null,"Save the password in the last line and your preferred username in app/services/auth/auth.py"),(0,a.kt)("pre",null,(0,a.kt)("code",m({parentName:"pre"},{className:"language-python"}),'def get_db():\n    fake_users_db = {\n        "your_new_username": {\n            "username": "your_new_username",\n            "full_name": "New Full name",\n            "email": "new email",\n            "hashed_password": "$2b$12$qYnAxjQd..feDyPBYa/mDuRrH.PkcpNHJk3F.l/c0h3l/1NcZup7O     ",\n            "disabled": False,\n        },\n        "aicure": {\n            "username": "aicure",\n            "full_name": "AiCure OpenDBM",\n            "email": "opendbm@aicure.com",\n            "hashed_password": "$2b$12$k4R5SPuHkjFKBsQV5gAHl.e/BlxrX2z1H3vxiB9uGtaDZLFXjggCm",\n            "disabled": False,\n        },\n        "alice": {\n            "username": "alice",\n            "full_name": "Alice Wonderson",\n            "email": "alice@aicure.com",\n            "hashed_password": "fakehashedsecret2",\n            "disabled": True,\n        },\n    }\n    return fake_users_db\n')),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"After that you can login using either of these icons, or using the curl alternative")),(0,a.kt)(r.Z,{defaultValue:"docs",values:[{label:"API Docs",value:"docs"},{label:"cUrl",value:"curl"}],mdxType:"Tabs"},(0,a.kt)(l.Z,{value:"docs",mdxType:"TabItem"},(0,a.kt)("figure",null,(0,a.kt)("img",{src:"../docs/assets/opendbm_auth_symbol.png",width:"700",alt:"OpenDBM Auth"}),(0,a.kt)("figcaption",null,"ODBM Auth"))),(0,a.kt)(l.Z,{value:"curl",mdxType:"TabItem"},(0,a.kt)("pre",null,(0,a.kt)("code",m({parentName:"pre"},{className:"language-bash"}),"curl 'http://127.0.0.1:8000/odbm/v1/login' \\\n  -H 'Accept: application/json, text/plain, */*' \\\n  -H 'Authorization: Basic Og==' \\\n  -H 'Content-Type: application/x-www-form-urlencoded' \\\n  --data-raw 'grant_type=password&username=aicure&password=opendbm' \\\n")))),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},'Start with uploading the files, put the "local" string value in the ',(0,a.kt)("inlineCode",{parentName:"li"},"platform")," parameter, then save the upload file name. ")),(0,a.kt)(r.Z,{defaultValue:"docs",values:[{label:"API Docs",value:"docs"},{label:"cUrl",value:"curl"}],mdxType:"Tabs"},(0,a.kt)(l.Z,{value:"docs",mdxType:"TabItem"},(0,a.kt)("figure",null,(0,a.kt)("img",{src:"../docs/assets/opendbm_upload_file.png",width:"700",alt:"OpenDBM File Uploading"}),(0,a.kt)("figcaption",null,"ODBM File Uploading"))),(0,a.kt)(l.Z,{value:"curl",mdxType:"TabItem"},(0,a.kt)("pre",null,(0,a.kt)("code",m({parentName:"pre"},{className:"language-bash"}),"curl 'http://127.0.0.1:8000/odbm/v1/upload?file_name=facial_speech_verbal_video_test.mp4&file_extension=mp4&platform=local' \\\n  -H 'Authorization: Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhaWN1cmUiLCJleHAiOjE2NjI5MDM4MjB9.oYW3z44NdcBLZswxy4Vt1S2r92wYmus59NWnZYDr2CA' \\\n  -H 'Content-Type: multipart/form-data; ' \\\n  -H 'accept: application/json' \\\n  --data-raw $'Content-Disposition: form-data; name=\"file\"; filename=\"facial_speech_verbal_video_test.mp4\" Content-Type: video/mp4 \\\n  --compressed\n")))),(0,a.kt)("p",null,"The API response will be "),(0,a.kt)("pre",null,(0,a.kt)("code",m({parentName:"pre"},{className:"language-json"}),"{\n  \"info\": \"file 'facial_speech_verbal_video_test.mp4' saved at 'files/facial_speech_verbal_video_test.mp4'\"\n}\n")),(0,a.kt)("p",null,"Save the file location returned somewhere ",(0,a.kt)("inlineCode",{parentName:"p"},"files/facial_speech_verbal_video_test.mp4")),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"Then you can use any API you want, insert the previous upload file url into ",(0,a.kt)("inlineCode",{parentName:"li"},"file_url")," parameter. Then you can specify variables you want to get. For example, if you use the ",(0,a.kt)("inlineCode",{parentName:"li"},"/video/acoustic")," API, you can specify the request body like ")),(0,a.kt)("pre",null,(0,a.kt)("code",m({parentName:"pre"},{className:"language-json"}),'[\n    "audio_intensity",\n    "pitch_frequency"\n]\n')),(0,a.kt)(r.Z,{defaultValue:"docs",values:[{label:"API Docs",value:"docs"},{label:"cUrl",value:"curl"}],mdxType:"Tabs"},(0,a.kt)(l.Z,{value:"docs",mdxType:"TabItem"},(0,a.kt)("figure",null,(0,a.kt)("img",{src:"../docs/assets/opendbm_acoustic.png",width:"700",alt:"OpenDBM Test Acoustic API"}),(0,a.kt)("figcaption",null,"ODBM Test Acoustic API"))),(0,a.kt)(l.Z,{value:"curl",mdxType:"TabItem"},(0,a.kt)("pre",null,(0,a.kt)("code",m({parentName:"pre"},{className:"language-bash"}),"curl 'http://127.0.0.1:8000/odbm/v1/video/acoustic?file_url=files%2Ffacial_speech_verbal_video_test.mp4&platform=local' \\\n  -H 'Authorization: Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJhaWN1cmUiLCJleHAiOjE2NjI5MDkwMzd9.RQgtXhPCcgzctfuNg2GbByR9OMdr1vWTerl1iKPWqfk' \\\n  -H 'Content-Type: application/json' \\\n  -H 'accept: application/json' \\\n  --data-raw $'[\\n    \"audio_intensity\",\\n    \"pitch_frequency\"\\n]' \\\n  --compressed\n")))),(0,a.kt)("p",null,"After you execute the API, you will get the zip file, with the csv results compressed inside that file"),(0,a.kt)("blockquote",null,(0,a.kt)("p",{parentName:"blockquote"},"You can check more details on rest_api usage in ",(0,a.kt)("inlineCode",{parentName:"p"},"rest_api/README.md"))),(0,a.kt)("h2",m({},{id:"technology-stack"}),"Technology Stack"),(0,a.kt)("figure",null,(0,a.kt)("img",{src:"../docs/assets/odbm_tech_stack.png",width:"500",alt:"OpenDBM REST API Technology Stack"}),(0,a.kt)("figcaption",null,"ODBM REST API Technology Stack")),(0,a.kt)("p",null,"The OpenDBM API will use FastAPI framework. The main reason is because the asynchronous behaviour of FastAPI will works perfectly to complex and high performance methods like data upload, data pre / processing and other possible long operations."),(0,a.kt)("p",null,"We also use Uvicorn is an ASGI web server implementation for Python. Until recently Python has lacked a minimal low-level server/application interface for async frameworks. The ASGI specification fills this gap, and means we're now able to start building a common set of tooling usable across all async frameworks. Uvicorn currently supports HTTP/1.1 and WebSockets."),(0,a.kt)("h2",m({},{id:"api-documentations"}),"API Documentations"),(0,a.kt)("p",null,"The Rest API documentations can be found when you run the the app. Change the relative path to /docs or /redoc"),(0,a.kt)("figure",null,(0,a.kt)("img",{src:"../docs/assets/odbm_api_docs.png",width:"500",alt:"OpenDBM REST API Swagger API Docs"}),(0,a.kt)("figcaption",null,"ODBM REST API Swagger API Docs"),(0,a.kt)("img",{src:"../docs/assets/odbm_redocs.png",width:"500",alt:"OpenDBM REST API Redocs"}),(0,a.kt)("figcaption",null,"ODBM REST API Redocs")))}v.isMDXComponent=!0},6386:function(e,t,n){n.d(t,{Z:function(){return p}});var a=n(7378),r=n(8944),l="tabItem_wHwb",o=Object.defineProperty,i=Object.getOwnPropertySymbols,s=Object.prototype.hasOwnProperty,u=Object.prototype.propertyIsEnumerable,c=(e,t,n)=>t in e?o(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n;function p({children:e,hidden:t,className:n}){return a.createElement("div",((e,t)=>{for(var n in t||(t={}))s.call(t,n)&&c(e,n,t[n]);if(i)for(var n of i(t))u.call(t,n)&&c(e,n,t[n]);return e})({role:"tabpanel",className:(0,r.Z)(l,n)},{hidden:t}),e)}},7789:function(e,t,n){n.d(t,{Z:function(){return v}});var a=n(7378),r=n(8944),l=n(4185),o=n(7886),i=n(7184),s=n(2112),u="tabList_J5MA",c="tabItem_l0OV",p=Object.defineProperty,d=Object.defineProperties,m=Object.getOwnPropertyDescriptors,f=Object.getOwnPropertySymbols,h=Object.prototype.hasOwnProperty,b=Object.prototype.propertyIsEnumerable,y=(e,t,n)=>t in e?p(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,k=(e,t)=>{for(var n in t||(t={}))h.call(t,n)&&y(e,n,t[n]);if(f)for(var n of f(t))b.call(t,n)&&y(e,n,t[n]);return e};function g(e){var t,n;const{lazy:l,block:p,defaultValue:f,values:h,groupId:b,className:y}=e,g=a.Children.map(e.children,(e=>{if((0,a.isValidElement)(e)&&"value"in e.props)return e;throw new Error(`Docusaurus error: Bad <Tabs> child <${"string"==typeof e.type?e.type:e.type.name}>: all children of the <Tabs> component should be <TabItem>, and every <TabItem> should have a unique "value" prop.`)})),v=null!=h?h:g.map((({props:{value:e,label:t,attributes:n}})=>({value:e,label:t,attributes:n}))),w=(0,o.l)(v,((e,t)=>e.value===t.value));if(w.length>0)throw new Error(`Docusaurus error: Duplicate values "${w.map((e=>e.value)).join(", ")}" found in <Tabs>. Every value needs to be unique.`);const O=null===f?f:null!=(n=null!=f?f:null==(t=g.find((e=>e.props.default)))?void 0:t.props.value)?n:g[0].props.value;if(null!==O&&!v.some((e=>e.value===O)))throw new Error(`Docusaurus error: The <Tabs> has a defaultValue "${O}" but none of its children has the corresponding value. Available values are: ${v.map((e=>e.value)).join(", ")}. If you intend to show no default tab, use defaultValue={null} instead.`);const{tabGroupChoices:_,setTabGroupChoices:I}=(0,i.U)(),[T,N]=(0,a.useState)(O),P=[],{blockElementScrollPositionUntilNextRender:A}=(0,s.o5)();if(null!=b){const e=_[b];null!=e&&e!==T&&v.some((t=>t.value===e))&&N(e)}const D=e=>{const t=e.currentTarget,n=P.indexOf(t),a=v[n].value;a!==T&&(A(t),N(a),null!=b&&I(b,String(a)))},j=e=>{var t,n;let a=null;switch(e.key){case"ArrowRight":{const n=P.indexOf(e.currentTarget)+1;a=null!=(t=P[n])?t:P[0];break}case"ArrowLeft":{const t=P.indexOf(e.currentTarget)-1;a=null!=(n=P[t])?n:P[P.length-1];break}}null==a||a.focus()};return a.createElement("div",{className:(0,r.Z)("tabs-container",u)},a.createElement("ul",{role:"tablist","aria-orientation":"horizontal",className:(0,r.Z)("tabs",{"tabs--block":p},y)},v.map((({value:e,label:t,attributes:n})=>{return a.createElement("li",(l=k({role:"tab",tabIndex:T===e?0:-1,"aria-selected":T===e,key:e,ref:e=>P.push(e),onKeyDown:j,onFocus:D,onClick:D},n),o={className:(0,r.Z)("tabs__item",c,null==n?void 0:n.className,{"tabs__item--active":T===e})},d(l,m(o))),null!=t?t:e);var l,o}))),l?(0,a.cloneElement)(g.filter((e=>e.props.value===T))[0],{className:"margin-top--md"}):a.createElement("div",{className:"margin-top--md"},g.map(((e,t)=>(0,a.cloneElement)(e,{key:t,hidden:e.props.value!==T})))))}function v(e){const t=(0,l.Z)();return a.createElement(g,k({key:String(t)},e))}}}]);